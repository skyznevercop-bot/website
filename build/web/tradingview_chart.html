<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; background: #131722; overflow: hidden; }
    #tv_chart_container { width: 100%; height: 100%; }
  </style>
</head>
<body>
  <div id="tv_chart_container"></div>

  <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
  <script type="text/javascript">
    var params = new URLSearchParams(window.location.search);
    var currentSymbol = params.get('symbol') || 'BINANCE:BTCUSDT';
    var currentTheme = params.get('theme') || 'dark';

    function createChart(symbol) {
      currentSymbol = symbol;
      var container = document.getElementById('tv_chart_container');
      container.innerHTML = '';

      new TradingView.widget({
        container_id: 'tv_chart_container',
        autosize: true,
        symbol: symbol,
        interval: '5',
        timezone: 'Etc/UTC',
        theme: currentTheme,
        style: '1',
        locale: 'en',
        toolbar_bg: '#131722',
        enable_publishing: false,
        allow_symbol_change: true,
        hide_top_toolbar: false,
        hide_legend: false,
        hide_side_toolbar: false,
        save_image: false,
        calendar: false,
        hide_volume: false,
        withdateranges: true,
        details: false
      });
    }

    // Initial chart load.
    createChart(currentSymbol);

    // Listen for symbol changes from the parent Flutter app.
    window.addEventListener('message', function(event) {
      if (event.data && event.data.type === 'changeSymbol' && event.data.symbol) {
        if (event.data.symbol !== currentSymbol) {
          createChart(event.data.symbol);
        }
      }
    });
  </script>
</body>
</html>
